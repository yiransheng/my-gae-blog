if(typeof Object.create!=="function"){Object.create=function(b){function a(){}a.prototype=b;return new a()}}var Sheng=Sheng||(function(a){var b=function(){if(a.Sheng){return a.Sheng}var c=Object.create(b.methods);c.prototype=b.methods;c.extend(c,b.properties);a.Sheng=c;return c};b.properties={installed:["core"],version:"1.0",url:"http://github.com/yiransheng/sheng.js"};b.methods={extend:function(f,e){var d=arguments.callee||this.extend,c,g;if(typeof e=="undefined"){c={};d.apply(b||a,[c,this]);d.apply(b||a,[c,f]);return c}for(g in e){if(e.hasOwnProperty(g)){f[g]=e[g];if(e==this||f==this){f[g].extend=d}}}return f},toArray:function(f,e){if(f instanceof Array){return f}var c=[],d;if(f instanceof Object){for(d in f){e==true?c.unshift(f[d]):c.push(f[d])}}else{c.push(f)}return c},map:function(h,g,e){var c=[],d;e=e instanceof Object?e:this;for(d in h){c.push(g.call(e,h[d]))}return c},proxy:function(e,h){var g=function(c){return c};return this.decorate(e,g,h)},decorate:function(e,g,h){return function(){var c=h||this;return g(e).apply(c,arguments)}},create:function(d,c){proto=d instanceof Object?d:(this[d]||{});if(c instanceof Object){return this.extend(Object.create(proto),c)}else{return Object.create(proto)}},install:function(c,j,h){var e=this,g="Dependencies Unsatisfied: ",k=j instanceof Array?j:e.toArray(j);if(!e.checkDependencies.apply(e,k)){g=g+j.join(",");throw g;return}h(e);e.installed.push(c);e=e.extend(Object.create(e.prototype),e)},checkDependencies:function(){var d=this.installed,c;for(c in arguments){if(d.indexOf(arguments[c])==-1){return false}}return true}};return b})(window)();Sheng.install("events","core",function(a){a.events={eventSplitter:/\s+/,trigger:function(f){var h,g,b,k,e,c;k=a.dispatcher;if(this!==k){e=a.toArray(arguments).concat([this]);k.trigger.apply(k,e)}f=f.split(this.eventSplitter);if(!(g=this._callbacks)){return this}e=a.toArray(arguments);e.shift();while(h=f.shift()){if(b=g[h]){for(c=0;c<b.length;c++){b[c].apply((b.context||this),e)}}}return this},bind:function(d,g,c){var f,e,b;if(!g){return this}d=d.split(this.eventSplitter);f=this._callbacks||(this._callbacks={});while(e=d.shift()){b=f[e]||(f[e]=[]);b.context=c||this;b.unshift(g)}return this},unbind:function(d,h,c){var g,b,f,e;if(!(f=this._callbacks)){return}if(!(d||h||c)){delete this._callbacks;return this}b=[];for(e in f){b.push(e)}d=d?d.split(this.eventSplitter):b;while(g=d.shift()){if(f[g]){if(!h){delete f[g]}else{if((i=f.indexOf(callbak))>-1){f.splice(i,1)}}}}return this},},a.dispatcher=a.extend({},a.events)});Sheng.install("point","core",function(a){a.extend(a.prototype,{point:function(c,f,d){var e=Object.create(a.Point);if(d){a.extend(e.config,d)}e.set(c,f);return e},});var b=b||{x:0,y:0,config:{xkey:["0","x","left"],ykey:["1","y","top"]},set:function(c,h){var e="Failed to set value to a Point Object",g=false,f=false,d;if(typeof c=="number"&&typeof h=="number"){this.x=c;this.y=h;return this}if(!(c instanceof Object)){throw e}for(d in c){if(this.config.xkey.indexOf(d)>-1){this.x=c[d];g=true}else{if(this.config.ykey.indexOf(d)>-1){this.y=c[d];f=true}}if(g&&f){return this}}if(!g&&!f){throw e}else{return this}},add:function(c){this.x=this.x+c.x;this.y=this.y+c.y;return this},subtract:function(c){this.x=this.x-c.x;this.y=this.y-c.y;return this},scale:function(c){this.x=this.x*c;this.y=this.y*c;return this},dotprod:function(c){return this.x*c.x+this.y*c.y},vecprod:function(c){return this.x*c.y+this.y*c.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(d){d=typeof d=="number"?d:1;var c=this.length();return this.scale(d/c)},clone:function(){return a.point(this)},equal:function(c){return this.x==c.x&&this.y==c.y}};a.Point=b});Sheng.install("particle",["core","point","events"],function(a){a.extend(a,{Particle:{p:a.point(0,0),v:a.point(0,0),a:a.point(0,0),update:function(){this.v.add(this.a);if(!this.outBound(this)){this.p.add(this.v)}},outBound:null,bounce:function(b){var c=a.point(b);c.normalize();c.scale(-2*c.dotprod(this.v));this.v.add(c)},destroy:function(){var c=this,b;for(b in c){delete c[b]}}},ParticleSys:{init:function(b){this.particles=[];a.extend(this.Options,b);return this},add:function(e){var h,g,b,d,c,f;h=arguments;for(c=0;c<h.length;c++){g=h[c];b=this.particles;d=this.Options;if(b.length>=d.maxsize){f=b.shift();if(!d.silent){this.trigger("remove",f)}}b.push(g);g.outBound=this.outBound;if(!d.silent){this.trigger("add",g)}}return this},remove:function(f){var c,g,b,e,h,d;h=arguments;for(d=0;d<h.length;d++){g=h[d];b=this.particles;e=this.Options;c=b.indexOf(g);if(c>-1){b.splice(c,1);if(!e.silent){this.trigger("remove",g)}}}return this},Options:{maxsize:10000,silent:false},outBound:new Function,updateAll:function(){var c,b;for(b=0;b<this.particles.length;b++){c=this.particles[b];c.update();if(c.render){c.render()}}}}});a.extend(a.ParticleSys,a.events)});Sheng.install("timeline",["core","events"],function(a){a.extend(a.prototype,{timeline:function(c){var b=Object.create(a.Timeline);a.extend(b,a.events);b.config(c);return b}});a.Timeline={EVENT_ENTER_FRAME:"enterFrame",option:{fps:30},tid:null,active:false,config:function(b){if(!(typeof b=="undefined")){this.option.fps=b}return this},start:function(){this.active=true;this._enterFrame();return this},_enterFrame:function(){if(this.active){this.tid=setTimeout(a.proxy(this._enterFrame,this),Math.floor(1000/this.option.fps));this.trigger(this.EVENT_ENTER_FRAME,this.tid)}},stop:function(){this.active=false;clearTimeout(this.tid);return this},toggle:function(){if(this.active){this.stop()}else{this.start()}return this}}});