if(typeof Object.create!=="function"){Object.create=function(c){function d(){}d.prototype=c;return new d()}}var Sheng=Sheng||(function(d){var c=function(){if(d.Sheng){return d.Sheng}var a=Object.create(c.methods);a.prototype=c.methods;a.extend(a,c.properties);d.Sheng=a;return a};c.properties={installed:["core"],version:"1.0",url:"http://github.com/yiransheng/sheng.js"};c.methods={extend:function(b,h){var j=arguments.callee||this.extend,k,a;if(typeof h=="undefined"){k={};j.apply(c||d,[k,this]);j.apply(c||d,[k,b]);return k}for(a in h){if(h.hasOwnProperty(a)){b[a]=h[a];if(h==this||b==this){b[a].extend=j}}}return b},toArray:function(a,b){if(a instanceof Array){return a}var h=[],g;if(a instanceof Object){for(g in a){b==true?h.unshift(a[g]):h.push(a[g])}}else{h.push(a)}return h},map:function(a,b,f){var k=[],j;f=f instanceof Object?f:this;for(j in a){k.push(b.call(f,a[j]))}return k},proxy:function(f,a){var b=function(e){return e};return this.decorate(f,b,a)},decorate:function(f,b,a){return function(){var e=a||this;return b(f).apply(e,arguments)}},create:function(a,b){proto=a instanceof Object?a:(this[a]||{});if(b instanceof Object){return this.extend(Object.create(proto),b)}else{return Object.create(proto)}},install:function(n,b,f){var m=this,l="Dependencies Unsatisfied: ",a=b instanceof Array?b:m.toArray(b);if(!m.checkDependencies.apply(m,a)){l=l+b.join(",");throw l;return}f(m);m.installed.push(n);m=m.extend(Object.create(m.prototype),m)},checkDependencies:function(){var a=this.installed,b;for(b in arguments){if(a.indexOf(arguments[b])==-1){return false}}return true}};return c})(window)();Sheng.install("events","core",function(b){b.events={eventSplitter:/\s+/,trigger:function(m){var j,l,a,d,n,o;d=b.dispatcher;if(this!==d){n=b.toArray(arguments).concat([this]);d.trigger.apply(d,n)}m=m.split(this.eventSplitter);if(!(l=this._callbacks)){return this}n=b.toArray(arguments);n.shift();while(j=m.shift()){if(a=l[j]){for(o=0;o<a.length;o++){a[o].apply((a.context||this),n)}}}return this},bind:function(l,h,m){var j,k,a;if(!h){return this}l=l.split(this.eventSplitter);j=this._callbacks||(this._callbacks={});while(k=l.shift()){a=j[k]||(j[k]=[]);a.context=m||this;a.unshift(h)}return this},unbind:function(n,j,o){var k,a,l,m;if(!(l=this._callbacks)){return}if(!(n||j||o)){delete this._callbacks;return this}a=[];for(m in l){a.push(m)}n=n?n.split(this.eventSplitter):a;while(k=n.shift()){if(l[k]){if(!j){delete l[k]}else{if((i=l.indexOf(callbak))>-1){l.splice(i,1)}}}}return this},},b.dispatcher=b.extend({},b.events)});Sheng.install("point","core",function(d){d.extend(d.prototype,{point:function(h,a,g){var b=Object.create(d.Point);if(g){d.extend(b.config,g)}b.set(h,a);return b},});var c=c||{x:0,y:0,config:{xkey:["0","x","left"],ykey:["1","y","top"]},set:function(m,a){var k="Failed to set value to a Point Object",b=false,j=false,l;if(typeof m=="number"&&typeof a=="number"){this.x=m;this.y=a;return this}if(!(m instanceof Object)){throw k}for(l in m){if(this.config.xkey.indexOf(l)>-1){this.x=m[l];b=true}else{if(this.config.ykey.indexOf(l)>-1){this.y=m[l];j=true}}if(b&&j){return this}}if(!b&&!j){throw k}else{return this}},add:function(a){this.x=this.x+a.x;this.y=this.y+a.y;return this},subtract:function(a){this.x=this.x-a.x;this.y=this.y-a.y;return this},scale:function(a){this.x=this.x*a;this.y=this.y*a;return this},dotprod:function(a){return this.x*a.x+this.y*a.y},vecprod:function(a){return this.x*a.y+this.y*a.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(a){a=typeof a=="number"?a:1;var b=this.length();return this.scale(a/b)},clone:function(){return d.point(this)},equal:function(a){return this.x==a.x&&this.y==a.y}};d.Point=c});Sheng.install("particle",["core","point","events"],function(b){b.extend(b,{Particle:{p:b.point(0,0),v:b.point(0,0),a:b.point(0,0),update:function(){this.v.add(this.a);if(!this.outBound(this)){this.p.add(this.v)}},outBound:null,bounce:function(a){var d=b.point(a);d.normalize();d.scale(-2*d.dotprod(this.v));this.v.add(d)},destroy:function(){var d=this,a;for(a in d){delete d[a]}}},ParticleSys:{init:function(a){this.particles=[];b.extend(this.Options,a);return this},add:function(m){var j,k,a,n,o,l;j=arguments;for(o=0;o<j.length;o++){k=j[o];a=this.particles;n=this.Options;if(a.length>=n.maxsize){l=a.shift();if(!n.silent){this.trigger("remove",l)}}a.push(k);k.outBound=this.outBound;if(!n.silent){this.trigger("add",k)}}return this},remove:function(l){var o,k,a,m,j,n;j=arguments;for(n=0;n<j.length;n++){k=j[n];a=this.particles;m=this.Options;o=a.indexOf(k);if(o>-1){a.splice(o,1);if(!m.silent){this.trigger("remove",k)}}}return this},Options:{maxsize:10000,silent:false},outBound:new Function,updateAll:function(){var d,a;for(a=0;a<this.particles.length;a++){d=this.particles[a];d.update();if(d.render){d.render()}}}}});b.extend(b.ParticleSys,b.events)});Sheng.install("timeline",["core","events"],function(b){b.extend(b.prototype,{timeline:function(d){var a=Object.create(b.Timeline);b.extend(a,b.events);a.config(d);return a}});b.Timeline={EVENT_ENTER_FRAME:"enterFrame",option:{fps:30},tid:null,active:false,config:function(a){if(!(typeof a=="undefined")){this.option.fps=a}return this},start:function(){this.active=true;this._enterFrame();return this},_enterFrame:function(){if(this.active){this.tid=setTimeout(b.proxy(this._enterFrame,this),Math.floor(1000/this.option.fps));this.trigger(this.EVENT_ENTER_FRAME,this.tid)}},stop:function(){this.active=false;clearTimeout(this.tid);return this},toggle:function(){if(this.active){this.stop()}else{this.start()}return this}}});var IMG=new Image();IMG.src=$("#logo")[0].src;$(IMG).bind("load",function(){var z,c,A,v,b,o,u,g,e,h,B,s,q,t=this,m,j,a,k,w,n,f,d,r=$("#logo")[0];c=$("#stage");if(!(c[0].getContext&&(z=c[0].getContext("2d")))){c.remove();return}b=r.offsetWidth||200;o=r.offsetHeight||200;a=Sheng.point(b/2,0);k=Sheng.point(0,o/2);$("#stage-wrapper").css({position:"absolute",top:"29px",left:"93px",});c.css({display:"none",});c[0].width=b;c[0].height=o;A=Sheng.Particle.extend({line:null,dest:null});v=Sheng.ParticleSys.extend({diff:0,j1:15,j2:85,on:false,outBound:function(x){var l=x.p.x+x.v.x;if(l<-b/2||l>b/2){x.v.x*=-1;return true}return false},updateAll:function(){var F,C,y,x,l,D,E,H=this.diff<60?Math.random()*b:0,G=this.diff<60?Math.random()*b:0;this.j1=this.j1>=this.j2-5?Math.min(H,G):this.j1;this.j2=this.j2<=this.j1+5?Math.max(H,G,this.j1+15):this.j2;for(y=0;y<this.particles.length;y++){l=this.particles[y];l.p.x+=l.v.x;E=(-l.p.x)*(Math.random()*0.05+0.05);l.v.x+=E;l.v.x*=(Math.random()*0.1+0.9);E=Math.abs(E);this.diff*=0.9;if(this.diff<=2&&E<0.05){l.v.x=Math.random()*3-1.5}else{if(E<0.05&&y>this.j1&&y<this.j2){l.p.x=Math.random()*b*0.75-b*0.35;l.v.x=Math.random()*10-5;this.j1+=Math.random();this.j2-=Math.random()}else{this.diff+=E*5}}this.diff=this.diff>99?99:this.diff;C=4*y*b;for(x=l.beg*4;x<l.end*4;x++){D=x-Math.round(l.p.x)*4;if(D>=0&&D<b*4){this.imageData.data[C+x]=l.line[D]*(1-E/3)}else{this.imageData.data[C+x]=180}}}z.putImageData(this.imageData,0,0)}});g=Sheng.create(v);g.init({silent:true,maxsize:b*o});e=Sheng.timeline(20);e.bind(e.EVENT_ENTER_FRAME,function(){g.updateAll()});redValueForPixel=function(l,p){l=Math.round(l);p=Math.round(p);return((p-1)*(b*4))+((l-1)*4)};if(!(b&&o)){return}z.drawImage(t,0,0,b,o);B=z.getImageData(0,0,b,o);s=B.data;g.imageData=B;for(j=1;j<=B.height;j++){f=(j-1)*b*4;d=f+b*4;n=Array.prototype.slice.apply(s,[f,d]);w=2*j/o-1;w=Math.acos(w);w=Math.sin(w)*o/2;u=Sheng.create(A,{p:Sheng.point(0,j),v:Sheng.point(0,0),a:null,beg:Math.round(b/2-w),end:Math.round(b/2+w),line:n});u.dest=Sheng.point(0,j);g.add(u)}$("#stage-wrapper").bind("mouseover",function(p){p.preventDefault();var l=c||$("#stage");if(!l.is(":animated")){e.start();l.fadeIn("slow")}else{e.start()}});$("#stage-wrapper").bind("mouseout",function(p){p.preventDefault();var l=c||$("#stage");if(!l.is(":animated")){l.fadeOut("slow",function(){e.stop()})}else{e.stop()}})});