if(typeof Object.create!=="function"){Object.create=function(c){function d(){}d.prototype=c;return new d()}}var Sheng=Sheng||(function(d){var c=function(){if(d.Sheng){return d.Sheng}var a=Object.create(c.methods);a.prototype=c.methods;a.extend(a,c.properties);d.Sheng=a;return a};c.properties={installed:["core"],version:"1.0",url:"http://github.com/yiransheng/sheng.js"};c.methods={extend:function(b,h){var j=arguments.callee||this.extend,k,a;if(typeof h=="undefined"){k={};j.apply(c||d,[k,this]);j.apply(c||d,[k,b]);return k}for(a in h){if(h.hasOwnProperty(a)){b[a]=h[a];if(h==this||b==this){b[a].extend=j}}}return b},toArray:function(a,b){if(a instanceof Array){return a}var h=[],g;if(a instanceof Object){for(g in a){b==true?h.unshift(a[g]):h.push(a[g])}}else{h.push(a)}return h},map:function(a,b,f){var k=[],j;f=f instanceof Object?f:this;for(j in a){k.push(b.call(f,a[j]))}return k},proxy:function(f,a){var b=function(e){return e};return this.decorate(f,b,a)},decorate:function(f,b,a){return function(){var e=a||this;return b(f).apply(e,arguments)}},create:function(a,b){proto=a instanceof Object?a:(this[a]||{});if(b instanceof Object){return this.extend(Object.create(proto),b)}else{return Object.create(proto)}},install:function(n,b,f){var m=this,l="Dependencies Unsatisfied: ",a=b instanceof Array?b:m.toArray(b);if(!m.checkDependencies.apply(m,a)){l=l+b.join(",");throw l;return}f(m);m.installed.push(n);m=m.extend(Object.create(m.prototype),m)},checkDependencies:function(){var a=this.installed,b;for(b in arguments){if(a.indexOf(arguments[b])==-1){return false}}return true}};return c})(window)();Sheng.install("events","core",function(b){b.events={eventSplitter:/\s+/,trigger:function(m){var j,l,a,d,n,o;d=b.dispatcher;if(this!==d){n=b.toArray(arguments).concat([this]);d.trigger.apply(d,n)}m=m.split(this.eventSplitter);if(!(l=this._callbacks)){return this}n=b.toArray(arguments);n.shift();while(j=m.shift()){if(a=l[j]){for(o=0;o<a.length;o++){a[o].apply((a.context||this),n)}}}return this},bind:function(l,h,m){var j,k,a;if(!h){return this}l=l.split(this.eventSplitter);j=this._callbacks||(this._callbacks={});while(k=l.shift()){a=j[k]||(j[k]=[]);a.context=m||this;a.unshift(h)}return this},unbind:function(n,j,o){var k,a,l,m;if(!(l=this._callbacks)){return}if(!(n||j||o)){delete this._callbacks;return this}a=[];for(m in l){a.push(m)}n=n?n.split(this.eventSplitter):a;while(k=n.shift()){if(l[k]){if(!j){delete l[k]}else{if((i=l.indexOf(callbak))>-1){l.splice(i,1)}}}}return this},},b.dispatcher=b.extend({},b.events)});Sheng.install("point","core",function(d){d.extend(d.prototype,{point:function(h,a,g){var b=Object.create(d.Point);if(g){d.extend(b.config,g)}b.set(h,a);return b},});var c=c||{x:0,y:0,config:{xkey:["0","x","left"],ykey:["1","y","top"]},set:function(m,a){var k="Failed to set value to a Point Object",b=false,j=false,l;if(typeof m=="number"&&typeof a=="number"){this.x=m;this.y=a;return this}if(!(m instanceof Object)){throw k}for(l in m){if(this.config.xkey.indexOf(l)>-1){this.x=m[l];b=true}else{if(this.config.ykey.indexOf(l)>-1){this.y=m[l];j=true}}if(b&&j){return this}}if(!b&&!j){throw k}else{return this}},add:function(a){this.x=this.x+a.x;this.y=this.y+a.y;return this},subtract:function(a){this.x=this.x-a.x;this.y=this.y-a.y;return this},scale:function(a){this.x=this.x*a;this.y=this.y*a;return this},dotprod:function(a){return this.x*a.x+this.y*a.y},vecprod:function(a){return this.x*a.y+this.y*a.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(a){a=typeof a=="number"?a:1;var b=this.length();return this.scale(a/b)},clone:function(){return d.point(this)},equal:function(a){return this.x==a.x&&this.y==a.y}};d.Point=c});Sheng.install("particle",["core","point","events"],function(b){b.extend(b,{Particle:{p:b.point(0,0),v:b.point(0,0),a:b.point(0,0),update:function(){this.v.add(this.a);if(!this.outBound(this)){this.p.add(this.v)}},outBound:null,bounce:function(a){var d=b.point(a);d.normalize();d.scale(-2*d.dotprod(this.v));this.v.add(d)},destroy:function(){var d=this,a;for(a in d){delete d[a]}}},ParticleSys:{init:function(a){this.particles=[];b.extend(this.Options,a);return this},add:function(m){var j,k,a,n,o,l;j=arguments;for(o=0;o<j.length;o++){k=j[o];a=this.particles;n=this.Options;if(a.length>=n.maxsize){l=a.shift();if(!n.silent){this.trigger("remove",l)}}a.push(k);k.outBound=this.outBound;if(!n.silent){this.trigger("add",k)}}return this},remove:function(l){var o,k,a,m,j,n;j=arguments;for(n=0;n<j.length;n++){k=j[n];a=this.particles;m=this.Options;o=a.indexOf(k);if(o>-1){a.splice(o,1);if(!m.silent){this.trigger("remove",k)}}}return this},Options:{maxsize:10000,silent:false},outBound:new Function,updateAll:function(){var d,a;for(a=0;a<this.particles.length;a++){d=this.particles[a];d.update();if(d.render){d.render()}}}}});b.extend(b.ParticleSys,b.events)});Sheng.install("timeline",["core","events"],function(b){b.extend(b.prototype,{timeline:function(d){var a=Object.create(b.Timeline);b.extend(a,b.events);a.config(d);return a}});b.Timeline={EVENT_ENTER_FRAME:"enterFrame",option:{fps:30},tid:null,active:false,config:function(a){if(!(typeof a=="undefined")){this.option.fps=a}return this},start:function(){this.active=true;this._enterFrame();return this},_enterFrame:function(){if(this.active){this.tid=setTimeout(b.proxy(this._enterFrame,this),Math.floor(1000/this.option.fps));this.trigger(this.EVENT_ENTER_FRAME,this.tid)}},stop:function(){this.active=false;clearTimeout(this.tid);return this},toggle:function(){if(this.active){this.stop()}else{this.start()}return this}}});var IMG=new Image();IMG.src=$("#logo")[0].src;$(IMG).bind("load",function(){var u,c,v,t,b,l,s,f,d,g,w,q,m,r=this,j,h,a,e,k,n,o=$("#logo")[0];c=$("#stage");if(!(c[0].getContext&&(u=c[0].getContext("2d")))){c.remove();return}b=o.offsetWidth||200;l=o.offsetHeight||200;$("#stage-wrapper").css({position:"absolute",top:"29px",left:"93px",backgroundImage:r.src,backgroundRepeat:"no-repeat"});c[0].width=b;c[0].height=l;v=Sheng.Particle.extend({colorR:0,colorG:0,colorB:0,colorA:0});t=Sheng.ParticleSys.extend({outBound:function(y){var x=y.p.clone().add(y.v).subtract(Sheng.point(b/2,l/2));if(x.length()>b/2){y.bounce(x);return true}return false},updateAll:function(){var x,z,y,A,B;for(y=0;y<this.particles.length;y++){A=this.particles[y];A.update();B=A.dest.clone().subtract(A.p).scale(0.06);A.v.add(B);A.v.scale(Math.random()*0.1+0.9);if((x=B.length())<0.005&&Math.random()>0.5){A.v.set(Math.random()*40-15,Math.random())}z=redValueForPixel(A.p.x,A.p.y);this.imageData.data[z]=A.colorR;this.imageData.data[z+1]=A.colorG;this.imageData.data[z+2]=A.colorB;this.imageData.data[z+3]=Math.round((1-x/3)*A.colorA)}u.putImageData(this.imageData,0,0)}});f=Sheng.create(t);f.init({silent:true,maxsize:b*l});d=Sheng.timeline(20);d.bind(d.EVENT_ENTER_FRAME,function(){f.updateAll()});redValueForPixel=function(p,z){p=Math.floor(p);z=Math.floor(z);return((z-1)*(b*4))+((p-1)*4)};if(!(b&&l)){return}u.drawImage(r,0,0,b,l);w=u.getImageData(0,0,b,l);q=w.data;f.imageData=w;for(j=1;j<=w.width;j++){for(h=1;h<w.height;h++){a=q[redValueForPixel(j,h)];e=q[redValueForPixel(j,h)+1];k=q[redValueForPixel(j,h)+2];n=q[redValueForPixel(j,h)+3];if(n>0.05){s=Sheng.create(v,{p:Sheng.point(j,h),v:Sheng.point(Math.random()*b/10-b/14,Math.random()*l/20-l/30),a:Sheng.point(0,0),colorR:a,colorG:e,colorB:k,colorA:n});s.dest=Sheng.point(j,h);f.add(s)}}}$("#stage-wrapper").bind("mouseover",function(p){p.preventDefault();d.start()});$("#stage-wrapper").bind("mouseout",function(p){p.preventDefault();d.stop()});d.start()});